<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>README</title>
      <style>.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(98, 91, 80); background-color: rgb(247, 243, 238); overflow: auto; }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(8, 8, 7); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(8, 8, 7); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(142, 133, 117); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: rgb(113, 78, 218); }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(142, 133, 117); border-color: rgb(221, 204, 183); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top: 2px dashed rgb(221, 204, 183); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(8, 8, 7); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(221, 204, 183); }
.markdown-preview:not([data-use-github-style]) code { color: rgb(8, 8, 7); background-color: rgb(237, 228, 217); }
.markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(240, 233, 224); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(8, 8, 7); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(221, 204, 183) rgb(221, 204, 183) rgb(211, 189, 162); border-image: initial; background-color: rgb(237, 228, 217); }
.markdown-preview[data-use-github-style] { font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); overflow: scroll; }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left: 4px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { background-color: rgb(255, 255, 255); border-top: 1px solid rgb(204, 204, 204); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; background-color: rgba(0, 0, 0, 0.0392157); border-radius: 3px; }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; background: transparent; border: 0px; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border-radius: 3px; }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0px; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; background-color: rgb(252, 252, 252); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-image: initial; border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover .horizontal-scrollbar { visibility: visible; }
.markdown-preview .task-list-item-checkbox { position: absolute; margin: 0.25em 0px 0px -1.4em; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}
.line-number.bracket-matcher {
  background-color: #777;
}

.spell-check-misspelling .region {
  border-bottom: 2px dotted rgba(255, 51, 51, 0.75);
}
.spell-check-corrections {
  width: 25em !important;
}

pre.editor-colors {
  background-color: #f7f3ee;
  color: #625B50;
}
pre.editor-colors .wrap-guide {
  background-color: #EAE2D7;
}
pre.editor-colors .indent-guide {
  color: #EAE2D7;
}
pre.editor-colors .invisible-character {
  color: #EAE2D7;
}
pre.editor-colors .gutter {
  background-color: #F1EBE4;
  color: #A99A84;
}
pre.editor-colors .gutter .line-number.cursor-line {
  background-color: #EAE2D7;
  color: #625B50;
}
pre.editor-colors .gutter .line-number.cursor-line-no-selection {
  color: #625B50;
}
pre.editor-colors .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
pre.editor-colors .fold-marker:after {
  color: #A99A84;
}
pre.editor-colors .invisible {
  color: #625B50;
}
pre.editor-colors .cursor {
  color: #714EDA;
}
pre.editor-colors .selection .region {
  background-color: #EAE2D7;
}
pre.editor-colors .bracket-matcher .region {
  border-bottom: 2px solid #714EDA;
  position: absolute;
}
pre.editor-colors[mini] .scroll-view {
  padding-left: 1px;
}
.syntax--orange {
  color: #5b5245;
  background: rgba(242, 165, 60, 0.25);
}
.syntax--green {
  color: #51553F;
  background: rgba(155, 202, 20, 0.25);
}
.syntax--blue {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--purple {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--reset {
  color: inherit;
  background: none;
}
.syntax--reset-all .syntax--string.syntax--quoted,
.syntax--reset-all .syntax--string.syntax--punctuation,
.syntax--reset-all .syntax--string.syntax--regexp,
.syntax--reset-all .syntax--numeric,
.syntax--reset-all .syntax--boolean,
.syntax--reset-all .syntax--constant.syntax--keyword,
.syntax--reset-all .syntax--constant.syntax--symbol,
.syntax--reset-all .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--reset-all .syntax--nil {
  color: inherit;
  background: none;
}
.syntax--comment.syntax--block,
.syntax--comment.syntax--line {
  color: #5b5245;
  background: rgba(242, 165, 60, 0.25);
  display: inline-block;
  font-style: italic;
}
.syntax--comment.syntax--block .syntax--comment.syntax--punctuation,
.syntax--comment.syntax--line .syntax--comment.syntax--punctuation {
  color: #A78B65;
  background: none;
}
.syntax--string.syntax--regexp,
.syntax--string.syntax--quoted {
  color: #51553F;
  background: rgba(155, 202, 20, 0.25);
}
.syntax--string.syntax--regexp .syntax--punctuation.syntax--definition,
.syntax--string.syntax--quoted .syntax--punctuation.syntax--definition,
.syntax--string.syntax--regexp .syntax--punctuation.syntax--string,
.syntax--string.syntax--quoted .syntax--punctuation.syntax--string {
  color: #8C9563;
}
.syntax--string.syntax--regexp .syntax--embedded .syntax--string.syntax--quoted,
.syntax--string.syntax--quoted .syntax--embedded .syntax--string.syntax--quoted,
.syntax--string.syntax--regexp .syntax--embedded .syntax--string.syntax--punctuation,
.syntax--string.syntax--quoted .syntax--embedded .syntax--string.syntax--punctuation,
.syntax--string.syntax--regexp .syntax--embedded .syntax--string.syntax--regexp,
.syntax--string.syntax--quoted .syntax--embedded .syntax--string.syntax--regexp,
.syntax--string.syntax--regexp .syntax--embedded .syntax--numeric,
.syntax--string.syntax--quoted .syntax--embedded .syntax--numeric,
.syntax--string.syntax--regexp .syntax--embedded .syntax--boolean,
.syntax--string.syntax--quoted .syntax--embedded .syntax--boolean,
.syntax--string.syntax--regexp .syntax--embedded .syntax--constant.syntax--keyword,
.syntax--string.syntax--quoted .syntax--embedded .syntax--constant.syntax--keyword,
.syntax--string.syntax--regexp .syntax--embedded .syntax--constant.syntax--symbol,
.syntax--string.syntax--quoted .syntax--embedded .syntax--constant.syntax--symbol,
.syntax--string.syntax--regexp .syntax--embedded .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--string.syntax--quoted .syntax--embedded .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--string.syntax--regexp .syntax--embedded .syntax--nil,
.syntax--string.syntax--quoted .syntax--embedded .syntax--nil {
  color: inherit;
  background: none;
}
.syntax--string.syntax--regexp .syntax--regexp,
.syntax--string.syntax--quoted .syntax--regexp {
  color: inherit;
  background: none;
}
.syntax--constant.syntax--symbol,
.syntax--constant.syntax--keyword,
.syntax--constant.syntax--numeric,
.syntax--constant.syntax--boolean,
.syntax--constant.syntax--null,
.syntax--constant.syntax--nil {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--constant.syntax--symbol .syntax--punctuation.syntax--definition,
.syntax--constant.syntax--keyword .syntax--punctuation.syntax--definition,
.syntax--constant.syntax--numeric .syntax--punctuation.syntax--definition,
.syntax--constant.syntax--boolean .syntax--punctuation.syntax--definition,
.syntax--constant.syntax--null .syntax--punctuation.syntax--definition,
.syntax--constant.syntax--nil .syntax--punctuation.syntax--definition {
  color: #7992A6;
}
.syntax--keyword.syntax--control {
  font-weight: bold;
}
.syntax--html .syntax--meta.syntax--tag .syntax--entity.syntax--name {
  font-weight: bold;
}
.syntax--html .syntax--meta.syntax--tag .syntax--entity.syntax--attribute-name {
  font-style: italic;
}
.syntax--html .syntax--meta.syntax--tag .syntax--punctuation.syntax--definition.syntax--tag {
  color: #A99A84;
}
.syntax--source.syntax--clojure .syntax--storage.syntax--control {
  font-weight: bold;
}
.syntax--source.syntax--clojure .syntax--meta.syntax--definition .syntax--entity.syntax--global {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata {
  font-style: italic;
}
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--string.syntax--quoted,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--string.syntax--punctuation,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--string.syntax--regexp,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--numeric,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--boolean,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--constant.syntax--keyword,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--constant.syntax--symbol,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--source.syntax--clojure .syntax--meta.syntax--metadata .syntax--nil {
  color: inherit;
  background: none;
}
.syntax--source.syntax--clojure .syntax--punctuation.syntax--expression {
  color: #A99A84;
}
.syntax--source.syntax--css .syntax--meta.syntax--selector .syntax--entity.syntax--name.syntax--tag,
.syntax--source.syntax--css .syntax--class:not(.syntax--mixin) {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--css .syntax--constant.syntax--support {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--source.syntax--css .syntax--keyword {
  color: inherit;
  background: none;
}
.syntax--source.syntax--css .syntax--rgb-value {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--source.syntax--css .syntax--bracket.syntax--curly {
  color: #A99A84;
}
.syntax--source.syntax--css .syntax--punctuation.syntax--separator,
.syntax--source.syntax--css .syntax--punctuation.syntax--terminator {
  color: #A99A84;
}
.syntax--source.syntax--css .syntax--comment .syntax--class {
  color: inherit;
  background: none;
  font-weight: bold;
}
.syntax--source.syntax--elixir .syntax--entity.syntax--name.syntax--function {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--elixir .syntax--constant.syntax--language {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--source.syntax--elixir.syntax--embedded .syntax--constant.syntax--language {
  color: inherit;
  background: none;
}
.syntax--source.syntax--elm .syntax--entity.syntax--name.syntax--function {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--elm .syntax--meta.syntax--import .syntax--entity.syntax--name.syntax--function {
  color: inherit;
  background: none;
}
.syntax--source.syntax--elm .syntax--keyword.syntax--other:not(.syntax--colon):not(.syntax--arrow) {
  font-weight: bold;
}
.syntax--source.syntax--gfm .syntax--markup.syntax--heading {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
  display: inline-block;
}
.syntax--source.syntax--gfm .syntax--markup.syntax--heading .syntax--markup {
  background: none;
  color: #A984A7;
}
.syntax--source.syntax--gfm .syntax--markup.syntax--italic {
  font-style: italic;
}
.syntax--source.syntax--gfm .syntax--markup.syntax--bold {
  font-weight: bold;
}
.syntax--source.syntax--gfm .syntax--markup.syntax--strike {
  text-decoration: line-through;
}
.syntax--source.syntax--gfm .syntax--markup.syntax--code,
.syntax--source.syntax--gfm .syntax--markup.syntax--raw {
  display: inline-block;
  color: #5b5245;
  background: rgba(242, 165, 60, 0.25);
}
.syntax--source.syntax--gfm .syntax--markup.syntax--code .syntax--support,
.syntax--source.syntax--gfm .syntax--markup.syntax--raw .syntax--support {
  color: #5b5245;
}
.syntax--source.syntax--gfm .syntax--markup.syntax--code .syntax--source.syntax--embedded *,
.syntax--source.syntax--gfm .syntax--markup.syntax--raw .syntax--source.syntax--embedded * {
  color: inherit;
  background: none;
}
.syntax--source.syntax--gfm .syntax--comment {
  display: inline-block;
  font-style: normal;
  color: #51553F;
  background: rgba(155, 202, 20, 0.25);
}
.syntax--source.syntax--gfm .syntax--comment .syntax--link,
.syntax--source.syntax--gfm .syntax--comment .syntax--link .syntax--punctuation.syntax--definition,
.syntax--source.syntax--gfm .syntax--comment .syntax--comment {
  color: inherit;
  background: none;
}
.syntax--source.syntax--gfm .syntax--comment .syntax--support.syntax--quote {
  color: #8C9563;
}
.syntax--source.syntax--gfm .syntax--link {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--source.syntax--gfm .syntax--link .syntax--link {
  color: inherit;
  background: none;
}
.syntax--source.syntax--gfm .syntax--link .syntax--punctuation.syntax--definition {
  color: #7992A6;
}
.syntax--haml .syntax--meta.syntax--tag {
  font-weight: bold;
}
.syntax--haml .syntax--meta.syntax--tag .syntax--punctuation.syntax--definition.syntax--tag {
  color: #A99A84;
}
.syntax--haml .syntax--meta.syntax--line.syntax--ruby {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--haml .syntax--meta.syntax--line.syntax--ruby .syntax--string.syntax--regexp,
.syntax--haml .syntax--meta.syntax--line.syntax--ruby .syntax--string.syntax--quoted {
  color: inherit;
  background: none;
}
.syntax--haml .syntax--meta.syntax--line.syntax--ruby .syntax--string.syntax--regexp .syntax--punctuation.syntax--definition,
.syntax--haml .syntax--meta.syntax--line.syntax--ruby .syntax--string.syntax--quoted .syntax--punctuation.syntax--definition,
.syntax--haml .syntax--meta.syntax--line.syntax--ruby .syntax--string.syntax--regexp .syntax--punctuation.syntax--string,
.syntax--haml .syntax--meta.syntax--line.syntax--ruby .syntax--string.syntax--quoted .syntax--punctuation.syntax--string {
  color: inherit;
}
.syntax--haml .syntax--constant.syntax--symbol {
  color: inherit;
  background: none;
}
.syntax--source.syntax--js .syntax--meta.syntax--function .syntax--entity.syntax--name.syntax--function {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--js .syntax--meta.syntax--function .syntax--storage.syntax--function {
  font-weight: bold;
}
.syntax--source.syntax--js .syntax--constant.syntax--key {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--source.syntax--js .syntax--variable.syntax--this {
  font-style: italic;
}
.syntax--source.syntax--js .syntax--storage.syntax--var {
  font-weight: bold;
}
.syntax--source.syntax--jsx .syntax--entity.syntax--name.syntax--class {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--jsx .syntax--storage.syntax--type {
  font-weight: bold;
}
.syntax--source.syntax--jsx .syntax--meta.syntax--function-call .syntax--entity.syntax--name.syntax--function,
.syntax--source.syntax--jsx .syntax--meta.syntax--method-call .syntax--entity.syntax--name.syntax--function {
  color: inherit;
  background: none;
}
.syntax--source.syntax--jsx .syntax--meta.syntax--tag .syntax--entity.syntax--name.syntax--tag {
  font-weight: bold;
}
.syntax--source.syntax--jsx .syntax--meta.syntax--tag .syntax--punctuation.syntax--definition.syntax--tag {
  color: #A99A84;
}
.syntax--source.syntax--json .syntax--string.syntax--quoted {
  color: inherit;
  background: none;
}
.syntax--source.syntax--json .syntax--string.syntax--quoted .syntax--punctuation.syntax--definition,
.syntax--source.syntax--json .syntax--string.syntax--quoted .syntax--punctuation.syntax--string {
  color: #A99A84;
}
.syntax--source.syntax--json .syntax--punctuation.syntax--separator {
  color: #A99A84;
}
.syntax--text.syntax--php .syntax--entity.syntax--name.syntax--class,
.syntax--text.syntax--php .syntax--entity.syntax--name.syntax--function {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--text.syntax--php .syntax--constant.syntax--language {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--text.syntax--php .syntax--storage.syntax--class,
.syntax--text.syntax--php .syntax--storage.syntax--function {
  font-weight: bold;
}
.syntax--text.syntax--php .syntax--punctuation.syntax--terminator.syntax--expression {
  color: #A99A84;
}
.syntax--source.syntax--python .syntax--entity.syntax--name.syntax--class,
.syntax--source.syntax--python .syntax--entity.syntax--name.syntax--function {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--python .syntax--constant.syntax--language {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--source.syntax--python .syntax--variable.syntax--self {
  font-style: italic;
}
.syntax--source.syntax--ruby .syntax--meta .syntax--class.syntax--name,
.syntax--source.syntax--ruby .syntax--meta .syntax--function.syntax--name {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--source.syntax--ruby .syntax--name.syntax--module {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded {
  color: #485561;
  background: rgba(115, 185, 255, 0.25);
}
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--string.syntax--quoted,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--string.syntax--quoted,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--string.syntax--quoted,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--string.syntax--quoted,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--string.syntax--punctuation,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--string.syntax--punctuation,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--string.syntax--punctuation,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--string.syntax--punctuation,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--string.syntax--regexp,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--string.syntax--regexp,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--string.syntax--regexp,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--string.syntax--regexp,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--numeric,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--numeric,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--numeric,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--numeric,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--boolean,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--boolean,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--boolean,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--boolean,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--constant.syntax--keyword,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--constant.syntax--keyword,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--constant.syntax--keyword,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--constant.syntax--keyword,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--constant.syntax--symbol,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--constant.syntax--symbol,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--constant.syntax--symbol,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--constant.syntax--symbol,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--constant .syntax--punctuation.syntax--definition,
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--nil,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--nil,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--nil,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--nil {
  color: inherit;
  background: none;
}
.syntax--html.syntax--ruby .syntax--rails.syntax--embedded .syntax--punctuation.syntax--section.syntax--embedded,
.syntax--html.syntax--erb .syntax--rails.syntax--embedded .syntax--punctuation.syntax--section.syntax--embedded,
.syntax--html.syntax--ruby .syntax--meta.syntax--embedded .syntax--punctuation.syntax--section.syntax--embedded,
.syntax--html.syntax--erb .syntax--meta.syntax--embedded .syntax--punctuation.syntax--section.syntax--embedded {
  color: #7992A6;
}
.syntax--html.syntax--ruby .syntax--string.syntax--quoted .syntax--embedded,
.syntax--html.syntax--erb .syntax--string.syntax--quoted .syntax--embedded {
  color: inherit;
  background: none;
}
.syntax--html.syntax--ruby .syntax--string.syntax--quoted .syntax--embedded .syntax--punctuation.syntax--section,
.syntax--html.syntax--erb .syntax--string.syntax--quoted .syntax--embedded .syntax--punctuation.syntax--section {
  color: inherit;
}
.syntax--source.syntax--rust .syntax--entity.syntax--name.syntax--class,
.syntax--source.syntax--rust .syntax--entity.syntax--name.syntax--function {
  color: #664B64;
  background: rgba(220, 155, 250, 0.25);
}
</style>
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="lesson-05-spatial-joins-hexbins-and-heat-mapping">Lesson 05: Spatial Joins, Hexbins, and Heat Mapping</h1>
<h2 id="table-of-contents">Table of Contents</h2>

<ul>
<li><a href="#lesson-05-spatial-joins-hexbins-and-heat-mapping">Lesson 05: Spatial Joins, Hexbins, and Heat Mapping</a><ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#data-files">Data files</a></li>
<li><a href="#spatial-join">Spatial join</a><ul>
<li><a href="#using-hexbins-for-thematic-mapping">Using hexbins for thematic mapping</a></li>
</ul>
</li>
<li><a href="#coordinate-reference-systems">Coordinate Reference Systems</a><ul>
<li><a href="#selecting-your-coordinate-system">Selecting your coordinate system</a></li>
<li><a href="#create-a-custom-coordinate-system">Create a custom coordinate system</a></li>
</ul>
</li>
<li><a href="#extracting-our-layers-for-analysis">Extracting our layers for analysis</a><ul>
<li><a href="#extract-to-geojson">Extract to GeoJSON</a></li>
<li><a href="#extract-to-spatial-database">Extract to spatial database</a><ul>
<li><a href="#create-three-layers">Create three layers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#styling-your-preliminary-map">Styling your preliminary map</a></li>
<li><a href="#join-attributes-by-location-tool-spatial-join">Join attributes by location tool (spatial join)</a></li>
<li><a href="#spatial-joins-in-postgis">Spatial joins in PostGIS</a></li>
<li><a href="#hex-binning-analysis">Hex binning analysis</a><ul>
<li><a href="#qgis-tool-based-workflow">QGIS tool-based workflow</a><ul>
<li><a href="#create-hexagonal-grid-with-the-mmqgis-plugin">Create hexagonal grid with the MMQGIS plugin</a></li>
<li><a href="#spatial-join-wildfires-to-hexgrid">Spatial join wildfires to hexgrid</a></li>
<li><a href="#styling-your-output">Styling your output</a></li>
</ul>
</li>
<li><a href="#spatial-join-and-hex-binning-in-sql">Spatial join and hex binning in SQL</a><ul>
<li><a href="#create-hexagonal-grid">Create hexagonal grid</a></li>
<li><a href="#spatial-join-wildfires-to-hexgrid">Spatial join wildfires to hexgrid</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#making-a-heat-map-in-qgis">Making a heat map in QGIS</a><ul>
<li><a href="#pseudocolor-raster-bands">Pseudocolor raster bands</a></li>
<li><a href="#raster-layer-widgets">Raster Layer widgets</a></li>
<li><a href="#weighted-heatmap">Weighted heatmap</a></li>
</ul>
</li>
<li><a href="#many-methods-to-visualize-point-data">Many methods to visualize point data</a></li>
<li><a href="#addendum-harness-sql-for-extended-analysis-and-support">Addendum: Harness SQL for extended analysis and support</a><ul>
<li><a href="#creating-summary-statistics-and-tables-for-export">Creating summary statistics and tables for export</a></li>
<li><a href="#create-a-function-to-automate-repetitive-tasks">Create a function to automate repetitive tasks</a></li>
</ul>
</li>
<li><a href="#resources-and-references">Resources and references</a></li>
</ul>
</li>
</ul>

<h2 id="overview">Overview</h2>
<p>This module takes point-level data and explores analysis techniques for their thematic representation using QGIS: spatial joins, hex binning, and the heat mapping.</p>
<p>In this module, we will:</p>
<ul>
<li>Conduct an analysis of high-density point data</li>
<li>Perform a spatial join, also know as a point in polygon analysis</li>
<li>Create hexagonal grids in PostGIS and/or QGIS plugins functions</li>
<li>Use spatial indexes for queries</li>
<li>make 'heatmap' representations of data</li>
<li>explore raster symbology</li>
<li>assess the different techniques for point data visualization</li>
</ul>
<h2 id="data-files">Data files</h2>
<p>This week we have a 'whopper' of a dataset:</p>
<p><strong>US Wildfires 1992-2013</strong> SpatiaLite database <a href="https://www.dropbox.com/s/nppa9gbmfpt2xf0/Wildfires_1992-2013_NAD83.sqlite.zip?dl=0">on Dropbox</a></p>
<ul>
<li>Derived from: Short, Karen C. 2015. Spatial wildfire occurrence data for the United States, 1992-2013 [FPA_FOD_20150323]. 3rd Edition. Fort Collins, CO: Forest Service Research Data Archive. <a href="https://doi.org/10.2737/RDS-2013-0009.3">https://doi.org/10.2737/RDS-2013-0009.3</a><ul>
<li>There is an updated version (2017) if you want to use that dataset instead.</li>
</ul>
</li>
<li>Also contains 1:500k scale county and state polygons from <a href="https://www.census.gov/geo/maps-data/data/tiger-cart-boundary.html">U.S. Census Bureau Cartographic Boundary Shapefiles</a>, but you can use the county and state polygons from the previous lesson.</li>
</ul>
<h2 id="spatial-join">Spatial join</h2>
<p>In a previous lesson, we joined attributes from different tables based on a field of shared values. In this lesson, we'll join attributes from different layers based on shared locations of their features. We'll do a <em>point in polygon</em> or <em>many to one</em> spatial join that will count the number points from one layer that are within polygons of another layer.</p>
<p>We have another type of spatial join, the <em>one to many</em> which will join the attributes of the <em>one</em> that intersects the <em>many</em>. Imagine if you GPS mapped public water fountains in your city and you want to add attributes from a polgon layer, e.g., city council districts. A <em>one to many</em> spatial join would add the attributes of the council district to each intersecting water fountain point. We'll leave this type of join for another day.</p>
<p>The <em>many to one</em> spatial join is easy to imagine for our lesson; we have locations of wildfires and we want to aggregate them by county to identify which county has the most wildfire. We will create summary statistics for our attributes, such as the average fire size by state or the largest fire in each county. Because our attribute table doesn't offer consistent information describing in which county the incident occurred, we will spatial join point to polygon to analyze patterns at different units of geography.</p>
<p>As we found in a previous lesson, if we map raw quantities, e.g., total acres burned in a county, we'll need to normalize by the size of the county. This requires that we divide the sum of the area burned by the county's area (being sure to convert the areas to same unit). This would create a choropleth map showing the ratio of county's area burned by wildfire. What if we joined wildfires to polygons of the same size? This technique is called hex binning and helps quickly visualize point density across an area.</p>
<h3 id="using-hexbins-for-thematic-mapping">Using hexbins for thematic mapping</h3>
<p>What are hexbins, aka hexagonal grids, and why are they cool for mappers? Hex binning is a technique used to aggregate a large number of points into hexagonal grids. The method is similar to making a choropleth map, though rather than taking political boundaries as the aggregation unit, we tile equally-sized, adjacent, and non-overlapping polygons. The regular hexagon is our polygon of choice, so you should <a href="https://hexnet.org/content/hexagonal-geometry">review the hexagon's curious geometry</a>.</p>
<p>We'll create hexagonal grids using the MMQGIS plugin and/or the <a href="https://carto.com/docs/tips-and-tricks/carto-functions/">PostGIS functions</a> developed by CARTO. A tiled grid can be comprised of squares, equilateral triangles, or hexagons.</p>
<p>With over 1.7 million records in our dataset, we will need a good way to visualize and analyze these points. We'll spatial join to aggregate by county and hexagonal grids.</p>
<p>Unlike our previous lessons, we will need to transform our layer's coordinate systems to a local or equal-area CRS.</p>
<h2 id="coordinate-reference-systems">Coordinate Reference Systems</h2>
<p>For displaying maps, we use the 'on the fly' projection method to make our layers overlap regardless of the layer's source CRS. When we use geospatial algorithms that have distance as an input parameter, e.g., creating hexagons of a fixed size, we need to use a projected coordinate system with a linear unit of measure.</p>
<p>Most of the geospatial data we find online, especially small-scale vector data, is in either WGS84 or NAD83, which are geographic coordinate systems. These geographic coordinate systems are the standard for a web mapping workflow, and we'll always need to manage them properly. For example, we know that we need to export GeoJSONs in a WGS84 CRS to use online. Try <a href="http://geojson.io">geojson.io</a> to verify your web mapping layers.</p>
<p>However, a hexagon grid generated in WGS84 or NAD83 will not maintain equal areas for hexagons across a large area, which defeats the purpose of hex binning. So, we need to find a local projected coordinate to use in our analysis.</p>
<h3 id="selecting-your-coordinate-system">Selecting your coordinate system</h3>
<p>Let's review our projected coordinate reference systems and find a good CRS for our state. We call these local CRS as compared to global CRS. We have (generally) two families of local, projected CRSs we can use, Universal Transverse Mercator (UTM) and State Plane Coordinate System (SPCS).</p>
<p>UTM zones span the globe, based on the WGS84 GCS, and always have a meter as the linear unit of measure.  The State Plane Coordinate System was developed to maintain the highest level of measurement capability on maps of U.S. states. They are tuned to each state, and most states have multiple zones tuned to even smaller regions in that state. They are based on the NAD83 GCS with multiple datum realizations (correcting for the shifting of North America due to plate tectonics) and offer both meter and feet linear units of measure.</p>
<p>Both families maximize the accuracy of measuring shape, distance, and area for the areas they cover. If we create a hexagon grid in one of these coordinate systems, then we're confident that our hexagons will maintain identical areas in any projection.</p>
<p>Which to use? UTM zones are pretty easy to use, but if you want foot as a linear unit of measure, you'll need an SPCS zone. If your state has many SPSC zones, generally the <em>Central Zone</em> or <em>Single Zone</em> will be good for the entire state. For example, Kentucky has a single zone SPSC (EPSG: 3089).</p>
<p>For small scale maps, we have used North America Albers Equal Area Conic projection (EPSG: 102008) for and the Mollweide projection (EPSG: 54009).</p>
<h3 id="create-a-custom-coordinate-system">Create a custom coordinate system</h3>
<p>You can create a custom projection in QGIS. For example, if you wanted to tune the Albers equal-area conic projection to Hawaii's island chain you need to modify three projection parameters. First, copy the CRS definition in QGIS <strong>Project Properties | CRS</strong> at the bottom:</p>
<pre class="editor-colors lang-"><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>+proj=aea&nbsp;+lat_1=20&nbsp;+lat_2=60&nbsp;+lat_0=40&nbsp;+lon_0=-96&nbsp;+x_0=0&nbsp;+y_0=0&nbsp;+datum=NAD83&nbsp;+units=m&nbsp;+no_defs</span></span></div></pre><p>Then go to the QGIS menu and find <strong>Settings &gt; Custom CRS...</strong>. Paste the definition and give the new CRS a descriptive name. The <em>PROJ.4</em> parameters that you'll need to change to focus on Hawaii:</p>
<ul>
<li>Central Meridian (<em>lon_0</em>) is the longitude where you want the map centered. Hawaii is -156°.</li>
<li>Standard Parallel 1 (<em>lat_1</em>) is the bottom of your area, 9°</li>
<li>Standard Parallel 2 (<em>lat_2</em>) is the top of your area, 36°</li>
<li>A third parallel might be given (<em>lat_0</em>) which is either a <em>Latitude of origin</em> or <em>Latitude of center</em>. The later is between <em>lat_1</em> and <em>lat_2</em>. The <em>Latitude of center</em> is 22.5°.</li>
</ul>
<p>An example CRS definition would be:</p>
<pre class="editor-colors lang-"><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>+proj=aea&nbsp;+lat_1=9&nbsp;+lat_2=36&nbsp;+lat_0=13.5&nbsp;+lon_0=-156&nbsp;+x_0=0&nbsp;+y_0=0&nbsp;+datum=NAD83&nbsp;+units=m&nbsp;+no_defs</span></span></div></pre><p><img alt="Custom CRS for Hawaii island archipelago" src="graphics/q001_custom_crs.png"><br>Figure 01: Custom CRS for Hawaii island archipelago</p>
<p>These parallel and meridian values don't have to be exact. Visit <a href="http://epsg.io">epsg.io</a> and look at the <em>Well Known Text (WKT)</em> for any CRS to discover the parameters. QGIS uses the <em>PROJ.4</em> definition and of course our spatial database would use <em>SQL (PostGIS)</em>. For more details about <em>PROJ.4</em> parameters, visit <a href="proj4.org">http://proj4.org/</a>.</p>
<h2 id="extracting-our-layers-for-analysis">Extracting our layers for analysis</h2>
<p>In our workflow, we'll render features for our area of interest (from datasets in NAD83 or WGS84) to a new spatial database layer (or GeoJSON layer) in the desired projected coordinate system. Because we're doing analysis with multiple layers, we need to make sure they are all in the same projected CRS. If we want to publish our results to an interactive web map, then we'll eventually <strong>Save As..</strong> the analysis ouptut layer to GeoJSON with a WGS84 CRS.</p>
<p>Extract and connect the "Wildfires_1992-2013_NAD83.sqlite" database. The database contains over 1.7 million points representing wildfires. While that is a large dataset by itself, the database contains a spatial index for the layers. That adds considerably to the file size of the database but has important advantages we'll address later in the lesson.</p>
<p>You may select any state to analyze for this lesson. I will select Kentucky and use the Kentucky State Plane single zone US foot (EPSG:3089), the official CRS for the state.</p>
<h3 id="extract-to-geojson">Extract to GeoJSON</h3>
<p>Add the _FPA_FOD<em>20150323 Fires</em> to your Layers Panel. You probably noticed that it took awhile to draw. Let's subset our desired region by right-clicking the layer and selecting <strong>Filter...</strong>:</p>
<p><img alt="Filtering a layer for Kentucky points" src="graphics/q001-filter.png"><br>Figure 02: Filtering a layer for Kentucky wildfire points</p>
<p>The query is:</p>
<pre class="editor-colors lang-"><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>"State"&nbsp;=&nbsp;'KY'</span></span></div></pre><p>Next, we need to save the layer to a new GeoJSON in the correct CRS, with a limited set of fields, and with full coordinate precision. Since we're interested in the size of the fire, we will only keep the field name <em>FIRE_SIZE</em>, which is the the area burned in acres. Right-click the layer and select <strong>Save As...</strong>:</p>
<p><img alt="Saving a GeoJSON layer for analysis" src="graphics/q002-save.png"><br>Figure 03: Saving a GeoJSON layer for analysis</p>
<p>Repeat the same steps for the county and state layers. We want to have three layers in our Layers Panel:</p>
<p><img alt="Three layers in Map Canvas" src="graphics/q00-three-layers.png"><br>Figure 04: Three layers in Map Canvas</p>
<h3 id="extract-to-spatial-database">Extract to spatial database</h3>
<p>Let's move the wildfire data from the SpatiaLite database to our PostGIS database, where we can leverage spatial indexes. PostGIS can create a spatial index that relates all geometry features in database. If we want to find which wildfires intersect a county, PostGIS queries this hidden table to quickly find matching records. This is done largely behind the scenes as long as we enable <strong>Create spatial index</strong> either during import or in DB Manager's <strong>Info</strong> table for the folder. Read more about <a href="http://workshops.boundlessgeo.com/postgis-intro/indexing.html#spatial-indexing">PostGIS spatial indexing</a>.</p>
<p>Let's first import the entire wildfire dataset into our database. This might take a little time, but it should be successful.</p>
<p><img alt="Import into PostGIS database" src="graphics/q002_import_db.png"><br>Figure 05: Import into PostGIS database</p>
<p>execute some SQL queries to isolate our state and transform the layers' CRS when we add them to our new schema in PostGIS I'm calling "ky" and intend to maintain all of my spatial layers in the EPSG: 3089 CRS. You can keep your layers in the <em>public</em> schema, but you should be aware of the CRS for your layers.</p>
<h4 id="create-three-layers">Create three layers</h4>
<p>Let's inspect our fire data. To limit the records returned from this huge set, use the following SQL:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;View&nbsp;the&nbsp;first&nbsp;10&nbsp;records&nbsp;in&nbsp;the&nbsp;database&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;us_wildfires</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>limit</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>10</span></span></span></div></pre>
<p>This query will give us enough attributes to craft a query that extracts just Kentucky:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Select&nbsp;Kentucky&nbsp;records&nbsp;in&nbsp;the&nbsp;database&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;us_wildfires</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>KY</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div></pre>
<p>Then we want to find only the fields pertinent to our analysis:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Select&nbsp;Kentucky&nbsp;records&nbsp;and&nbsp;useful&nbsp;field&nbsp;in&nbsp;the&nbsp;database&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geom,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;source_reporting_unit_name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;owner_descr,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_year,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_date,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_doy,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_time,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;stat_cause_descr,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size_class</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;us_wildfires</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;state&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>KY</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div></pre>
<p>Now, use the <code>st_transform()</code> function to project our layer to EPSG: 3089:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Select&nbsp;Kentucky&nbsp;records&nbsp;and&nbsp;useful&nbsp;field&nbsp;in&nbsp;the&nbsp;database&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;st_transform(geom,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom,&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;project&nbsp;to&nbsp;EPSG:&nbsp;3089</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;source_reporting_unit_name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;owner_descr,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_year,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_date,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_doy,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_time,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;stat_cause_descr,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size_class</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;us_wildfires</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;state&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>KY</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div></pre>
<p>Finally create the new layer in the new schema:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Select&nbsp;Kentucky&nbsp;records&nbsp;and&nbsp;useful&nbsp;field&nbsp;in&nbsp;the&nbsp;database&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;schema_name.table_name</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;project&nbsp;to&nbsp;EPSG:&nbsp;3089&nbsp;and&nbsp;define&nbsp;geometry&nbsp;type&nbsp;(point)&nbsp;and&nbsp;projection&nbsp;SRID</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;geometry&nbsp;type&nbsp;and&nbsp;SRID&nbsp;are&nbsp;found&nbsp;in&nbsp;the&nbsp;source&nbsp;(from)&nbsp;table</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;st_transform(geom,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)::geometry(</span><span class="syntax--storage syntax--type syntax--sql"><span>point</span></span><span>,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom,&nbsp;&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;source_reporting_unit_name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;owner_descr,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_year,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_date,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_doy,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_time,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;stat_cause_descr,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size_class</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;us_wildfires&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;the&nbsp;source&nbsp;table</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;state</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>KY</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span><span>;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;end&nbsp;first&nbsp;statement</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Second&nbsp;statement&nbsp;to&nbsp;designate&nbsp;primary&nbsp;key&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--add syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>add</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>primary&nbsp;key</span></span></span><span>&nbsp;(id);&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;end&nbsp;second&nbsp;statement</span></span></span></div></pre>
<p><img alt="Create new table in a new schema" src="graphics/q002_new_schema.png"><br>Figure 06: Create new table in a new schema</p>
<p>After a successful query is executed. Look at the <strong>Info</strong> tab for the table. DB Manager will highlight various items that need to be addressed. While we can write SQL to accomplish this, e.g., <code>vacuum analyze table_name</code> let's go ahead and click the links that DB Manager shows:</p>
<p><img alt="Fixing a new table's issues" src="graphics/q003_table_info.png"><br>Figure 07: Fixing a new table's issues</p>
<p>What if we forgot to add a field? We can always delete the table with <code>drop table table_name</code> and execute a new query. If we need to add a unique identifier (primary key) we can execute this query:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Create&nbsp;new&nbsp;id&nbsp;field&nbsp;as&nbsp;a&nbsp;primary&nbsp;key&nbsp;(auto&nbsp;incrementing&nbsp;and&nbsp;always&nbsp;unique)&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>add&nbsp;column</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>serial</span></span><span>&nbsp;</span><span class="syntax--storage syntax--modifier syntax--sql"><span>primary&nbsp;key</span></span><span>;</span></span></div></pre>
<p>Check your table's <strong>Info</strong> tab again to see if you are good to go:</p>
<p><img alt="A table ready for analysis" src="graphics/q004_good_table.png"><br>Figure 08: A table ready for analysis</p>
<p>Now create queries to use on the county and state layers to extract Kentucky.</p>
<p>The county layer:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Create&nbsp;counties&nbsp;layer&nbsp;in&nbsp;new&nbsp;projection&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;project&nbsp;to&nbsp;EPSG:&nbsp;3089&nbsp;and&nbsp;define&nbsp;geometry&nbsp;type&nbsp;(multipolygon)&nbsp;with&nbsp;projection</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;geometry&nbsp;type&nbsp;and&nbsp;SRID&nbsp;are&nbsp;found&nbsp;in&nbsp;the&nbsp;source&nbsp;(from)&nbsp;table</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;st_transform(geom,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)::geometry(multipolygon,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom,&nbsp;&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geoid,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;aland,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;awater</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;cb_2016_us_county_500k</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geoid&nbsp;</span><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>like</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>21%</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span><span>&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;Kentucy&nbsp;counties&nbsp;start&nbsp;with&nbsp;a&nbsp;21</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geoid;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;alphabetize&nbsp;output</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Second&nbsp;statement&nbsp;to&nbsp;designate&nbsp;primary&nbsp;key&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--add syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>add</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>primary&nbsp;key</span></span></span><span>&nbsp;(id);</span></span></div></pre>
<p>Now, the state layer:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Create&nbsp;state&nbsp;layer&nbsp;in&nbsp;new&nbsp;projection&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>state</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;project&nbsp;to&nbsp;EPSG:&nbsp;3089&nbsp;and&nbsp;define&nbsp;geometry&nbsp;type&nbsp;(multipolygon)&nbsp;with&nbsp;projection</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;geometry&nbsp;type&nbsp;and&nbsp;SRID&nbsp;are&nbsp;found&nbsp;in&nbsp;the&nbsp;source&nbsp;(from)&nbsp;table</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;st_transform(geom,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)::geometry(multipolygon,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom,&nbsp;&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geoid,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;aland,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;awater</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;cb_2016_us_state_500k</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geoid&nbsp;</span><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>like</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>21%</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span><span>;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;Kentucky's&nbsp;geoid&nbsp;is&nbsp;21</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Second&nbsp;statement&nbsp;to&nbsp;designate&nbsp;primary&nbsp;key&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>state</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--add syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>add</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>primary&nbsp;key</span></span></span><span>&nbsp;(id);</span></span></div></pre>
<p>Verify your database has Kentucky wildfire points, counties, and state outline.</p>
<p><img alt="Layers are loaded for analysis" src="graphics/q005_output_layers.png"><br>Figure 09: Layers are loaded for analysis</p>
<h2 id="styling-your-preliminary-map">Styling your preliminary map</h2>
<p>Let's add some initial styles to our layers. Since we're dealing with fire, let's make our points glow against a darker background. Select the wildfire points <strong>Style</strong> tab to <strong>Graduated</strong> by size using the _fire<em>size</em> attribute. Also, change the feature blending mode to <strong>Addition</strong>. The settings could be similar to:</p>
<p><img alt="Styling point data" src="graphics/q03-style-settings.png"><br>Figure 10: Styling point data for glow effect</p>
<p>Finally, style the other layers and set the <strong>Project Properties</strong> background color to a dark gray and make sure the on-the-fly CRS is set to "EPSG: 3089":</p>
<p><img alt="Simple map set up" src="graphics/q04-map.png"><br>Figure 11: Simple map set up</p>
<p>This is a decent visualization of wildfires in Kentucky. We're using the unique feature blending modes to imply wildfire rates; glowing areas imply more wildfire. However, we might need to quantify the rates, i.e., "what is maximum amount of wildfire area burned?" To accomplish this, we need to calculate the amount of wildfire area burned by an enumeration unit. We can count fire by county and then normalize by the county's area. The hexbin provides a useful unit, because we can easily show density with a spatial join as all hexagons are the same size.</p>
<h2 id="join-attributes-by-location-tool-spatial-join-">Join attributes by location tool (spatial join)</h2>
<p>QGIS has wrapped this type of analysis into a nice tool. We won't have the same type of control over attributes as we do in a spatial database, but it works. First, make sure you have the point and polygon layers in your <strong>Layers Panel</strong>. QGIS tools use these layers for selecting input. Find the tool in <strong>QGIS menu &gt; Vector &gt; Data Management Tools &gt; Join attributes by location</strong>.</p>
<p>The tool settings are almost identical to our spatial join SQL query. The main difference is that we can't select the attributes we want in the output and need to select <strong>Take summary of intersection features</strong> in the <strong>Attribute summary</strong> parameter. This allows for the "many-to-one" type spatial join. The tool settings should be:</p>
<p><img alt="Join attributes by location tool" src="graphics/q006_join_tool.png"><br>Figure 12: Join attributes by location tool</p>
<p>Let's discuss some considerations using this tool. First, you should use the GeoJSON layers with minimal fields or remove as many fields as necessary from a database layer. If any number field is encoded as a <em>TEXT</em> data type, this tool also won't change data types "on the fly". Also, every <em>NUMERIC</em> attribute will be subjected to summary statistics you select, though they might not make sense. So, as always, we need to be aware of our attributes before using this tool and convert them if necessary.</p>
<p>Depending on the format to which we output, we could change our column names.  If you don't specify a name in the <strong>Joined layer</strong> output you are making a temporary layer. You shouldn't have any field name changes. That's the preferred method. If you add a name for the output, it defaults to Shapefile format and truncates our long column names.</p>
<p><img alt="Join attributes by location tool" src="graphics/q007_join_tool.png"><br>Figure 13: output of Join attributes by location tool</p>
<p>Look at the fields, <em>sumfire_size</em> and <em>count</em>. This aggregates the acres of fire and the number of fires for each county. Many of these attributes are not useful. Let's not take a look at this method in PostGIS.</p>
<h2 id="spatial-joins-in-postgis">Spatial joins in PostGIS</h2>
<p>PostGIS is very efficient with spatial joins, but we'll divide the process in two steps.</p>
<ol>
<li>We'll find where points intersect spatially using the <code>st_intersects()</code> function and <code>group by</code> clause. This will create an attribute table that contains the fields <em>geoid</em>, <em>sum_fire_acres</em>, and <em>count</em> of wildfires.</li>
<li>Then we'll do an attribute join using the 'geoid' to attach the analysis table to the geometry table.</li>
</ol>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Spatial&nbsp;join&nbsp;wildfire&nbsp;points&nbsp;to&nbsp;county&nbsp;polygons&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;sum&nbsp;the&nbsp;fire&nbsp;acres&nbsp;and&nbsp;count&nbsp;the&nbsp;points&nbsp;in&nbsp;each&nbsp;polygon&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geoid,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>sum</span></span><span>(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.fire_size)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;sum_fire_acres,&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;sum()&nbsp;function</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>count</span></span><span>(</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;count&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;count()&nbsp;function</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Target&nbsp;layer&nbsp;with&nbsp;enumeration&nbsp;units&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>join</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Source&nbsp;layer&nbsp;that&nbsp;will&nbsp;be&nbsp;counted/analyzed&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DDL syntax--create syntax--II syntax--sql"><span>on</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Geometric&nbsp;predicate&nbsp;intersect&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;st_intersects(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.geom,</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geom)</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>group&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;The&nbsp;attribute&nbsp;that&nbsp;aggregates&nbsp;the&nbsp;intersecting&nbsp;points,&nbsp;the&nbsp;county&nbsp;geoid&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geoid</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;</span><span class="syntax--keyword syntax--other syntax--order syntax--sql"><span>desc</span></span></span></div></pre>
<p>This query yields:</p>
<p><img alt="Output from SQL spatial join query" src="graphics/q008_sql_output.png"><br>Figure 14: Output from SQL spatial join query</p>
<p>To create a final table, we use the <code>create table</code> clause:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geoid,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>sum</span></span><span>(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.fire_size)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;sum_fire_acres,&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;sum()&nbsp;function</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>count</span></span><span>(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;count&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;count()&nbsp;function</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Target&nbsp;layer&nbsp;with&nbsp;enumeration&nbsp;units&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>join</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Source&nbsp;layer&nbsp;that&nbsp;will&nbsp;be&nbsp;counted/analyzed&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DDL syntax--create syntax--II syntax--sql"><span>on</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Geometric&nbsp;predicate&nbsp;intersects&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;st_intersects(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.geom,</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geom)</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>group&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;The&nbsp;attribute&nbsp;that&nbsp;aggregates&nbsp;the&nbsp;intersecting&nbsp;points,&nbsp;the&nbsp;county&nbsp;geoid&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geoid</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;</span><span class="syntax--keyword syntax--other syntax--order syntax--sql"><span>desc</span></span></span></div></pre>
<p>If you have null values, let's remove them:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Convert&nbsp;null&nbsp;values&nbsp;to&nbsp;0&nbsp;since&nbsp;we&nbsp;know&nbsp;null&nbsp;is&nbsp;no&nbsp;fire&nbsp;here&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>update</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>set</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;sum_fire_acres&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>0</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;sum_fire_acres&nbsp;</span><span class="syntax--keyword syntax--other syntax--DDL syntax--create syntax--II syntax--sql"><span>is&nbsp;null</span></span></span></div></pre>
<p>Finally, create the attribute join so we can create the choropleth map. We do not need to <code>create table</code> since we've made all the density measurements in this join:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geom,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geoid,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.name,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.aland,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.awater,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.sum_fire_acres,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.count,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Find&nbsp;ratio&nbsp;burned&nbsp;with&nbsp;this&nbsp;conversion:&nbsp;4046.86&nbsp;sq&nbsp;m&nbsp;in&nbsp;an&nbsp;acre&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;((</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.sum_fire_acres</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span><span class="syntax--constant syntax--numeric syntax--sql"><span>4046.86</span></span><span>)</span><span class="syntax--keyword syntax--operator syntax--math syntax--sql"><span>/</span></span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.aland)::</span><span class="syntax--storage syntax--type syntax--sql"><span>numeric</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;ratio_burned</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geoid&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.geoid</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;ratio_burned&nbsp;</span><span class="syntax--keyword syntax--other syntax--order syntax--sql"><span>desc</span></span></span></div></pre>
<p>Let's now symbolize the county polygons by the attribute <em>ratio_burned</em>:</p>
<p><img alt="Example choropleth map of wildfires by county" src="graphics/q009_join_symbolized.png"><br>Figure 15: Example choropleth map of wildfires by county</p>
<h2 id="hex-binning-analysis">Hex binning analysis</h2>
<p>The workflow for hex binning is to</p>
<ol>
<li>create a hexbin that covers your area of interest</li>
<li>do a spatial join aggregating wildfire points by hexagon.</li>
</ol>
<h3 id="qgis-tool-based-workflow">QGIS tool-based workflow</h3>
<p>Let's start with the QGIS tool-based workflow using a plugin to create the hexgrid and then tool to perform the spatial join.</p>
<h4 id="create-hexagonal-grid-with-the-mmqgis-plugin">Create hexagonal grid with the MMQGIS plugin</h4>
<p>Let's get our first plugin for QGIS! One of the remarkable features of Q is the fervor and diversity of plugin development. Many of the tools we commonly use in QGIS started out as a plugin. We're going to install the <a href="https://plugins.qgis.org/plugins/mmqgis/">MMQGIS plugin</a> via QGIS's <strong>Plugin Manager</strong>. Find it the QGIS menu <strong>Plugins &gt; Manage and Install Plugins...</strong> Then, search for "MMQGIS" and install it:</p>
<p><img alt="Install MMQGIS plugin" src="graphics/q05-install-mmqgis.png"><br>Figure 16: Install MMQGIS plugin</p>
<p>After a successful install, find the new tools in QGIS's main menu entry, <strong>MMQGIS</strong>, which you should launch. Find the <strong>Create Grid Layer</strong> dialog to create a hexagonal grid layer. Find the plugin here:</p>
<p><img alt="Using MMQGIS plugin Create Grid Layer function" src="graphics/q_01_mmqgis_01.png"><br>Figure 17: Using MMQGIS plugin Create Grid Layer function</p>
<p>You should select the layer you want cover with a hexagonal grid. Since we're analyzing Kentucky wildfires, let's select that layer. The other parameters should be obvious except for the X and Y dimension. The correspond to the short diameter of a hexagon (X spacing) and the long diameter (Y spacing). If we wanted a 5-mile long-diameter hexagon, the Y spacing parameter would be 5*5280 = 26400:</p>
<p><img alt="Creating a hex grid with a 5-mile long diameter for each hexagon" src="graphics/q_01_mmqgis_02.png"><br>Figure 18: Creating a hex grid with a 5-mile long diameter for each hexagon</p>
<p>Your output should look similar to:</p>
<p><img alt="5-mile long diameter hexgrid" src="graphics/q003-output.png"><br>Figure 19: A 5-mile long diameter hexgrid covering Kentucky</p>
<p>It outputs to a Shapefile.</p>
<h4 id="spatial-join-wildfires-to-hexgrid">Spatial join wildfires to hexgrid</h4>
<p>Launch the QGIS menu tool &gt; <strong>Vector &gt; Data Management Tools &gt; Join attributes by location</strong>  and create a temporary layer that:</p>
<ul>
<li>counts all points intersecting each hexagon</li>
<li>sums the <em>fire_size</em> attribute (acres of wildfire) by each hexagon</li>
<li>keep only hexagons that have matching features</li>
</ul>
<p>The tool parameters should look like:</p>
<p><img alt="Spatial join wildfires to 5-mile long diameter hexgrid" src="graphics/q004-join.png"><br>Figure 20: Spatial join wildfires to 5-mile long diameter hexgrid</p>
<p>After a successful output, take a look at the attribute table. You should have a field called "sum_fire_size" which is total acreage per hexagon. You can sort by this field (double-clicking the field name) and select the record. That will highlight the hexagon with the most fire.</p>
<p><a name="styling-your-output"></a></p>
<h4 id="styling-your-output">Styling your output</h4>
<p>Access the properties for your joined layer and created a graduated color scheme using the <em>sum_fire_size</em> field. Add a little transparency to the layer and remove the hexagon outlines. Your style panel should look like:</p>
<p><img alt="Styling the hexagon layer" src="graphics/q005-style.png"><br>Figure 21: Styling the hexagon layer</p>
<p><img alt="Your final map visualization" src="graphics/q006-map.png"><br>Figure 22: Your final map visualization</p>
<p>The next section will explore the same process in SQL.</p>
<h3 id="spatial-join-and-hex-binning-in-sql">Spatial join and hex binning in SQL</h3>
<p>This tool provides convenience but lacks many of the options we find in our SQL method. Remember to save your successful SQL queries as .sql text files and reusing on different databases and datasets.</p>
<h4 id="create-hexagonal-grid">Create hexagonal grid</h4>
<p>We'll create hexagonal grids using a PostGIS function created by CARTO (formally CartoDB). A PostGIS function adds extra geoprocessing capabilities to our database. You can visit their <a href="https://github.com/CartoDB/cartodb-postgresql/tree/master/scripts-available">repository</a> to find more functions and will use their _CDB<em>Hexagon.sql</em> function.</p>
<p>Copy and paste this SQL in DB Manager and hit <strong>Execute</strong>: <a href="https://raw.githubusercontent.com/CartoDB/cartodb-postgresql/master/scripts-available/CDB_Hexagon.sql">CDB_Hexagon.sql</a>. Once this function is loaded, it can be accessed in the following statement:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span>CDB_HexagonGrid(geometry,&nbsp;length)</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;Units&nbsp;will&nbsp;be&nbsp;the&nbsp;in&nbsp;the&nbsp;input&nbsp;SRID</span></span></span></div></pre>
<ul>
<li>The <em>geometry</em> property is the layer you want to cover with hexagons (actually the layer's geometry field name, typically "geom")</li>
<li>The <em>length</em> property is the hexagons's side length (in the layer's CRS unit of measure)</li>
</ul>
<p>You can make a hexagon exactly 5-miles wide on the long diagonal (outer diameter) with the equation <code>side = diagonal/2</code>. Hexagons in an equal-area projected CRS also have the same area when they're projected to other CRSs. That's the purpose of hex binning; making polygons of the same size to measure density.</p>
<p>Let's use SQL to create a 5-mile diagonal hexagon grid. Use the following statement to cover your state of choice:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Make&nbsp;hexagonal&nbsp;grid&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;function&nbsp;requires&nbsp;geometry&nbsp;field&nbsp;and&nbsp;length&nbsp;of&nbsp;side.&nbsp;Notice&nbsp;the&nbsp;conversion&nbsp;to&nbsp;2.5&nbsp;miles&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;CDB_HexagonGrid(geom,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>2.5</span></span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span><span class="syntax--constant syntax--numeric syntax--sql"><span>5280</span></span><span>)::geometry(</span><span class="syntax--storage syntax--type syntax--sql"><span>polygon</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>state</span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;add&nbsp;unique&nbsp;identifier,&nbsp;which&nbsp;is&nbsp;important&nbsp;for&nbsp;the&nbsp;spatial&nbsp;join!&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>add&nbsp;column</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>serial</span></span><span>&nbsp;</span><span class="syntax--storage syntax--modifier syntax--sql"><span>primary&nbsp;key</span></span><span>;</span></span></div></pre>
<p>Now, inspect the layer in the DB Manager <strong>Info</strong>. Click on the <strong>Create spatial index</strong> link and then add the layer to the Map Canvas. Now you're ready to do the spatial join</p>
<p><img alt="5-mile diagonal hexagons" src="graphics/q05-hexbin-map.png"><br>Figure 23: Five-mile diagonal hexagons</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Make&nbsp;hexagonal&nbsp;grid&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Tip.&nbsp;Uncomment&nbsp;the&nbsp;following&nbsp;line&nbsp;to&nbsp;delete&nbsp;previous&nbsp;versions.</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span>This&nbsp;helps&nbsp;you&nbsp;explore&nbsp;options&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;drop&nbsp;table&nbsp;ky.hexgrid_5km;</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5km</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;function&nbsp;requires&nbsp;geometry&nbsp;field&nbsp;and&nbsp;length&nbsp;of&nbsp;side.&nbsp;Notice&nbsp;the&nbsp;conversion&nbsp;to&nbsp;2.5&nbsp;miles&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;CDB_HexagonGrid(st_collect(st_transform(geom,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>102008</span></span><span>)),&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>2500</span></span><span>)::geometry(</span><span class="syntax--storage syntax--type syntax--sql"><span>polygon</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>102008</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;collect&nbsp;and&nbsp;project&nbsp;to&nbsp;Albers&nbsp;equal-area&nbsp;projection&nbsp;with&nbsp;meter&nbsp;as&nbsp;linear&nbsp;unit</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;use&nbsp;point&nbsp;layer&nbsp;for&nbsp;input&nbsp;geometry</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;add&nbsp;unique&nbsp;identifier,&nbsp;which&nbsp;is&nbsp;important&nbsp;for&nbsp;the&nbsp;spatial&nbsp;join!&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5km</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>add&nbsp;column</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>serial</span></span><span>&nbsp;</span><span class="syntax--storage syntax--modifier syntax--sql"><span>primary&nbsp;key</span></span><span>;</span></span></div></pre>
<p>What if you wanted to make spatial index in SQL? Let's use the following statements:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Spatial&nbsp;index&nbsp;function&nbsp;syntax:</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span>CREATE&nbsp;INDEX&nbsp;[indexname]&nbsp;ON&nbsp;[tablename]&nbsp;USING&nbsp;GIST&nbsp;(&nbsp;[geometrycolumn]&nbsp;);</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span>The&nbsp;GIST&nbsp;stands&nbsp;for&nbsp;Generalized&nbsp;Search&nbsp;Tree&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>index</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--sql"><span>sidx_hexgrid_5mile</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--DDL syntax--create syntax--II syntax--sql"><span>on</span></span><span>&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>using</span></span><span>&nbsp;gist&nbsp;(geom);</span></span></div></pre>
<p>And finally:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Then&nbsp;clean&nbsp;up!&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>vacuum&nbsp;analyze&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span><span>;</span></span></div></pre>
<p>Let's say you have point layer that you want to cover with hexagons. We need to use the <code>st_collect()</code> function to gather the points into a single feature. Let's also project our data for a suitable CRS for North America:</p>
<h4 id="spatial-join-wildfires-to-hexgrid">Spatial join wildfires to hexgrid</h4>
<p>This procedure is exactly the same of joining wildfire points to county polygon. The main difference is using the <em>id</em> field as the <code>group by</code> column. Let's do the spatial join and then attribute join.</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Spatial&nbsp;Join&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span><span>.id&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>sum</span></span><span>(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.fire_size)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;sum_fire_acres,&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;sum()&nbsp;function</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>count</span></span><span>(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;count&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;count()&nbsp;function</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Target&nbsp;layer&nbsp;with&nbsp;enumeration&nbsp;units&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>join</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Source&nbsp;layer&nbsp;that&nbsp;will&nbsp;be&nbsp;counted/analyzed&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DDL syntax--create syntax--II syntax--sql"><span>on</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Geometric&nbsp;predicate&nbsp;intersects&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;st_intersects(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span><span>.geom,</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span><span>.geom)</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>group&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;The&nbsp;attribute&nbsp;that&nbsp;aggregates&nbsp;the&nbsp;intersecting&nbsp;points,&nbsp;the&nbsp;county&nbsp;geoid&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span><span>.id</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;</span><span class="syntax--keyword syntax--other syntax--order syntax--sql"><span>desc</span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Convert&nbsp;null&nbsp;values&nbsp;to&nbsp;zero&nbsp;for&nbsp;summary&nbsp;statistics&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>update</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>set</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;sum_fire_acres&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>0</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>0</span></span></span></div></pre>
<p>Now let's finish with the attribute join:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Attribute&nbsp;Join&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span><span>.id,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span><span>.geom,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span><span>.sum_fire_acres,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span><span>.count</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span><span>.id&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>hexgrid_5mile</span></span><span>.id;</span></span></div></pre>
<p><img alt="Five-mile hexbin map showing cumulative square miles of wildfire area" src="graphics/q16-hexagon-map.png"><br>Figure 24: Five-mile hexbin map showing cumulative square miles of wildfire area</p>
<p>Note that we don't need to normalize unless you want to show the ratio of burned area in each hexagon.</p>
<h2 id="making-a-heat-map-in-qgis">Making a heat map in QGIS</h2>
<p>Let's now turn to representing the same data with the heatmap, a visualization technique that produces a density raster. This tool is often called a kernel density function and the QGIS's help explains that it will "create a density (heatmap) raster of an input point vector layer. The density is calculated based on the number of points in a location, with larger numbers of clustered points resulting in larger values. Heatmaps allow easy identification of "hotspots" and clustering of points."</p>
<p>Ensure that the heatmap plugin is installed and activated. In QGIS main menu find <strong>Plugins &gt; Manage and Install Plugins... &gt; Heatmap</strong>.</p>
<p><img alt="Heatmap plugin for QGIS" src="graphics/heatmap-plugin.png"><br>Figure 25: Heatmap plugin for QGIS</p>
<p>Open the Heatmap Plugin (<strong>Raster &gt; Heatmap &gt; Heatmap ...</strong>). Within this dialog, select the wildfire point layer as input. The plugin will write a raster file in a GeoTIFF format to disk. Each cell in this raster will be a numeric value representing the number of fires per some area. Adjust the <strong>Radius</strong> parameter to 10,000 feet, which "specifies the distance around a point at which the influence of the point will be felt. Larger values result in greater smoothing, but smaller values may show finer details and variation in point density," as described in QGIS's help documentation.</p>
<p>Leave <strong>Advanced</strong> option disabled for now.</p>
<p><img alt="Settings for creating a heat map in QGIS" src="graphics/q17-heatmap-settings.png"><br>Figure 26: Settings for creating a heat map in QGIS</p>
<p>Let's look at an example using the search <strong>Radius</strong> parameter. If only two fires happened in a search radius and they happened at the same location, you would get an output value of 2 (fires per search radius). If they more distant than the search radius, the output value would be 1. If they were half the distance of the search radius from each other, the output value could 1.5, but it could any value between 1 and 2 depending on the <a href="https://en.wikipedia.org/wiki/Kernel_(statistics">kernel shape</a>) that defines the significance of neighboring points.</p>
<p><img alt="Kernel shapes" src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Kernels.svg/590px-Kernels.svg.png"><br>Figure 27: Kernel shapes from <a href="https://en.wikipedia.org/wiki/Kernel_(statistics">Wikipedia</a></p>
<p>The default result is a raster map where the lightest color indicates a high density of the given phenomena and the darker color shows a low density. You could say occurrences of fire in the search radius. If our search radius was sufficiently large, the output value would be very close to the total number of fires in the point layer. The values of the raster are currently being displayed using a continuous singleband grayscale.</p>
<p><img alt="Default grayscale output of Heatmap tool" src="graphics/q18-heatmap-gray.png"><br>Figure 28: Default grayscale output of Heatmap tool</p>
<p>Let's take a look at the raster layer's <strong>Properties &gt; Style</strong> tab, which is significantly different than vector styles.</p>
<p><img alt="Raster style properties" src="graphics/q18-heatmap-settings.png"><br>Figure 29: Raster style properties</p>
<p>In singleband gray rasters, cell values show a quantity, the number of wildfires in our search radius, which means we have a continuous range between the minimum and the maximum number of fires. By default, the grayscale color ramp is stretched to the min/max values, where black represents the minimum value and white represents maximum value. Click on <strong>Load min/max values</strong>, select <strong>Min/Max</strong>, enable <strong>Accuracy &gt; Actual (Slower)</strong>, and click <strong>Load</strong>. This gives us the total range of values in our dataset to represent. The hit <strong>Apply</strong>:</p>
<p><img alt="Adjust raster settings to show full range of values to symbolize" src="graphics/q18-raster-style.png"><br>Figure 30: Adjust raster settings to show full range of values to symbolize</p>
<p>Compare with the <strong>Cumulative count cut</strong> option, which compresses the tail ends of the frequency distribution. Adjust the numbers and see how you can best find the "hot spots" on the map:</p>
<p><img alt="Cumulative count cut method of defining range of values to symbolize" src="graphics/q19-raster-style.png"><br>Figure 31: Cumulative count cut method of defining range of values to symbolize</p>
<p>Using the singleband gray <strong>Render type</strong> will help us understand how raster cell values get colored on the map. However, it's a very exciting image and we how more options with different render types.</p>
<h3 id="pseudocolor-raster-bands">Pseudocolor raster bands</h3>
<p>Let's produce a colored version of this raster by adjusting the layer's properties. Under <strong>Render type</strong>, choose <strong>Singleband pseudocolor</strong> using a <strong>OrRd</strong> color scheme.</p>
<p><img alt="Rendering settings for singleband pseudocolor" src="graphics/q20-raster-style.png"><br>Figure 32: Rendering settings for singleband pseudocolor</p>
<p>Since we're concerned with high-density areas, let's make the low-density areas have less opacity. Click the Color <strong>Edit</strong> button and change the transparencies of the low-density color values:</p>
<p><img alt="Custom gradient color ramps" src="graphics/q21-raster-style.png"><br>Figure 33: Custom gradient color ramps</p>
<h3 id="raster-layer-widgets">Raster Layer widgets</h3>
<p>We have the option to embed widgets in the legend. The default widget is a transparency slider, which allows us to conveniently change a raster layers transparency.</p>
<p>Find the slider in the raster layer's <strong>Properties &gt; Legend</strong> tab. Add the widget and hit <strong>OK</strong>:</p>
<p><img alt="Raster layer transparency slider" src="graphics/q23-raster-widget.png"><br>Figure 34: Raster layer transparency slider</p>
<p>Map output:</p>
<p><img alt="Raster heatmap using pseudocolor settings and transparency slider" src="graphics/q22-raster-output.png"><br>Figure 35: Raster heatmap using pseudocolor settings and transparency slider</p>
<h3 id="weighted-heatmap">Weighted heatmap</h3>
<p>We can weight the points that we input to a heatmap function by a numeric attribute. We have fire size for each point that we can use. Let's create a new heatmap with the following options set:</p>
<p><img alt="Weighting a heatmap" src="graphics/q24-heatmap-weighted.png"><br>Figure 36: Weighting a heatmap with an attribute</p>
<p>After we style the raster output, you should see a similar map:</p>
<p><img alt="Weighting a heatmap" src="graphics/q24-heatmap-weighted-map.png"><br>Figure 37: A heatmap using fire size to weight the input points</p>
<p>This map shows the amount of land burned by fire (some areas burned multiple times over two decades), while the count of fires per search area shows the frequency of wildfire. It should be obvious that it takes only one wildfire to create massive damage.</p>
<p>As we can see, the heatmap gives us a lot of options to visualize spatial patterns, but it takes experimentation to find an appropriate setup. Keep at it and don't view my examples as the only option.</p>
<p>One last tip for working in raster: use transparency for your raster layers.</p>
<h2 id="many-methods-to-visualize-point-data">Many methods to visualize point data</h2>
<p>As we have explored in this lesson, we have numerous techniques to visualize point data in QGIS. Let's summarize the techniques we've used so far in a few maps.</p>
<p><img alt="Dot map (with custom feature blending mode) and hexagonal grid" src="graphics/q30-final-map.png"><br>Figure 38: Dot map (with custom feature blending mode) and hexagonal grid</p>
<p><img alt="Two subtly distinct heatmaps" src="graphics/q31-final-map.png"><br>Figure 39: Two subtly distinct heatmaps</p>
<h2 id="addendum-harness-sql-for-extended-analysis-and-support">Addendum: Harness SQL for extended analysis and support</h2>
<p>Let's explore some techniques to improved our productivity and experience with spatial databases.</p>
<h3 id="creating-summary-statistics-and-tables-for-export">Creating summary statistics and tables for export</h3>
<p>Here is where SQL can be shine. Imagine we want to add summary tables or clean up data to serve popup content on a web map. We need a way prep and combine field values to make a pretty table or popup. We'll use a couple numeric and string functions to prep and use the concatenate operator to combine string data.</p>
<p>If we wanted to create summary statistic tables that we could export for using in a layout, we could apply the following query:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Make&nbsp;table&nbsp;with&nbsp;summary&nbsp;statistics&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>summary_stats</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>avg</span></span><span>(sum_fire_acres)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>"</span></span><span>Average&nbsp;acres&nbsp;burned&nbsp;by&nbsp;hexagon</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>"</span></span></span><span>,&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;average&nbsp;statistical&nbsp;function</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>sum</span></span><span>(sum_fire_acres)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>"</span></span><span>Total&nbsp;cumulative&nbsp;acres&nbsp;burned</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>"</span></span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--support syntax--function syntax--aggregate syntax--sql"><span>max</span></span><span>(sum_fire_acres)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>"</span></span><span>Largest&nbsp;etc.</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>"</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_by_5mi_hexagon</span></span></span></div></pre>
<p>We can concatenate string columns together to make useful bits of information, such as for a web page and popup menus. Concatenation strings simply adds them two non null field together. The concatenation operator is PostGIS is the double pipe: <code>||</code>. Let's concatenate a summary statistics table for export to a web page:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Create&nbsp;HTML&nbsp;for&nbsp;addition&nbsp;to&nbsp;web&nbsp;page&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>county_summary_html</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;(</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>&lt;h3&gt;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.name</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>&nbsp;County&lt;/h3&gt;Total&nbsp;wildfire:&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--math syntax--sql"><span>round</span></span><span>(</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.sum_fire_acres::</span><span class="syntax--storage syntax--type syntax--sql"><span>numeric</span></span><span>,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>1</span></span><span>)&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;round()&nbsp;function&nbsp;needs&nbsp;to&nbsp;cast&nbsp;to&nbsp;numeric</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--math syntax--sql"><span>round</span></span><span>((((</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.sum_fire_acres</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span><span class="syntax--constant syntax--numeric syntax--sql"><span>4046.86</span></span><span>)</span><span class="syntax--keyword syntax--operator syntax--math syntax--sql"><span>/</span></span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.aland)::</span><span class="syntax--storage syntax--type syntax--sql"><span>numeric</span></span><span>)</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span><span class="syntax--constant syntax--numeric syntax--sql"><span>100</span></span><span>,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>1</span></span><span>)</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>%&lt;br&gt;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;html</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>,&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>counties</span></span><span>.geoid&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.geoid</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_analysis</span></span><span>.sum_fire_acres&nbsp;</span><span class="syntax--keyword syntax--other syntax--order syntax--sql"><span>desc</span></span></span></div></pre>
<p>Export this as a CSV file format and you should get lines of HTML:</p>
<pre class="editor-colors lang-html"><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Pike&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;116745.0&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;23.2%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Perry&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;73999.4&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;34.0%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Knott&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;67884.7&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;30.2%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Floyd&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;59944.7&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;23.8%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Clay&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;50828.3&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;16.9%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Breathitt&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;46893.1&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;14.9%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Leslie&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;45301.8&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;17.7%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Whitley&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;44057.6&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;15.7%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Harlan&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;41379.0&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;13.9%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Knox&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;33251.6&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;13.4%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Martin&nbsp;County</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Total&nbsp;wildfire:&nbsp;29157.4&nbsp;ac&nbsp;with&nbsp;a&nbsp;cumulative&nbsp;percent&nbsp;burned&nbsp;of&nbsp;19.8%</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span></span></div></pre>
<p>You might recognize this format and be able to add this to a web page. Should render in HTML to:</p>
<p></p><h3>Pike County</h3>Total wildfire: 116745.0 ac with a cumulative percent burned of 23.2%<br><p></p>
<p>Let's say we want to build a popup menu content from our wildfire points. After inspecting the attributes, try to build a sentence from the field values. First, we need to remove all null values to concatenate:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Field&nbsp;values&nbsp;cannot&nbsp;have&nbsp;null&nbsp;values&nbsp;to&nbsp;concatenate&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>update</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>set</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discovery_time&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>=</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_name&nbsp;</span><span class="syntax--keyword syntax--other syntax--DDL syntax--create syntax--II syntax--sql"><span>is&nbsp;null</span></span></span></div></pre>
<p>Then, create the point layer:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Create&nbsp;a&nbsp;single&nbsp;field&nbsp;that&nbsp;serves&nbsp;popup&nbsp;menu&nbsp;content&nbsp;for&nbsp;wildfire&nbsp;points&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfire_points_with_popup_content</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;(</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>&lt;h3&gt;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;fire_name&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>&lt;/h3&gt;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;fire_size</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>&nbsp;ac&nbsp;fire&nbsp;on&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;left(discovery_date,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>10</span></span><span>)&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;left()&nbsp;function&nbsp;returns&nbsp;left&nbsp;10&nbsp;characters</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>&lt;br&gt;caused&nbsp;by&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--concatenator syntax--sql"><span>||</span></span><span>&nbsp;stat_cause_descr&nbsp;)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;popup,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geom::geometry(</span><span class="syntax--storage syntax--type syntax--sql"><span>point</span></span><span>,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>3089</span></span><span>)&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>ky</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>wildfires</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size&nbsp;</span><span class="syntax--keyword syntax--other syntax--order syntax--sql"><span>desc</span></span></span></div></pre>
<p>The popup content should be similar to:</p>
<pre class="editor-colors lang-html"><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>10000&nbsp;ac&nbsp;fire&nbsp;on&nbsp;1999-11-08</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>7500&nbsp;ac&nbsp;fire&nbsp;on&nbsp;2001-11-01</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>4700&nbsp;ac&nbsp;fire&nbsp;on&nbsp;2000-11-02</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>4070&nbsp;ac&nbsp;fire&nbsp;on&nbsp;2001-11-02</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>3860&nbsp;ac&nbsp;fire&nbsp;on&nbsp;2000-11-01</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>3675&nbsp;ac&nbsp;fire&nbsp;on&nbsp;2000-10-31</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>3539&nbsp;ac&nbsp;fire&nbsp;on&nbsp;2000-10-30</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div><div class="line"><span class="syntax--text syntax--html syntax--basic"><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>Unnamed&nbsp;wildfire</span><span class="syntax--meta syntax--tag syntax--block syntax--h3 syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;/</span></span><span class="syntax--entity syntax--name syntax--tag syntax--block syntax--h3 syntax--html"><span>h3</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>3500&nbsp;ac&nbsp;fire&nbsp;on&nbsp;2000-11-03</span><span class="syntax--meta syntax--tag syntax--inline syntax--br syntax--html"><span class="syntax--punctuation syntax--definition syntax--tag syntax--begin syntax--html"><span>&lt;</span></span><span class="syntax--entity syntax--name syntax--tag syntax--inline syntax--br syntax--html"><span>br</span></span><span class="syntax--punctuation syntax--definition syntax--tag syntax--end syntax--html"><span>&gt;</span></span></span><span>caused&nbsp;by&nbsp;Arson</span></span></div></pre>
<p>Should render in HTML to:</p>
<p></p><h3>Unnamed wildfire</h3>10000 ac fire on 1999-11-08<br>caused by Arson<p></p>
<p>After a successful query, you can export that as a GeoJSON in the WGS84 CRS and you're ready for web mapping!</p>
<h3 id="create-a-function-to-automate-repetitive-tasks">Create a function to automate repetitive tasks</h3>
<p>Let's flirt with an ambitious goal. When we introduced the CARTO function to tesselate hexagons for our hex binning exercise, we used PL/pgSQL a procedural programming language supported by the PostgreSQL. This language is included by default with new server installations and other languages can accessed with extensions.  </p>
<p>Imagine we wanted to make a function that gave us a point layer of fires by cause and at least a certain size. The function would be called with two arguments:</p>
<p><code>function_name(cause, mimumum_fire_size)</code></p>
<p>Output would be table of fires that met those criteria. Here is the full function:</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>&nbsp;Find&nbsp;fire&nbsp;by&nbsp;cause&nbsp;that&nbsp;are&nbsp;at&nbsp;least&nbsp;a&nbsp;minimum&nbsp;size&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create&nbsp;or&nbsp;replace</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>function</span></span></span><span>&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;just&nbsp;as&nbsp;the&nbsp;words&nbsp;say!</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;name&nbsp;of&nbsp;function&nbsp;and&nbsp;list&nbsp;variables,&nbsp;their&nbsp;names,&nbsp;and&nbsp;data&nbsp;types</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_by_cause(cause&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>varchar</span></span><span>,&nbsp;acres&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>real</span></span><span>)</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>returns&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;function&nbsp;returns&nbsp;a&nbsp;table</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;define&nbsp;order,&nbsp;field&nbsp;name,&nbsp;and&nbsp;field&nbsp;data&nbsp;type</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;(</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;int8,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;geom&nbsp;geometry(</span><span class="syntax--storage syntax--type syntax--sql"><span>Point</span></span><span>,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>4269</span></span><span>),</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;cause_action&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>varchar</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;size_ac&nbsp;float8,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>varchar</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;report_unit_name&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>varchar</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;discover_date&nbsp;</span><span class="syntax--storage syntax--type syntax--sql"><span>varchar</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;)</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>$$&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;convention&nbsp;that&nbsp;shows&nbsp;function&nbsp;block</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--LUW syntax--sql"><span>BEGIN</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>return&nbsp;query&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;return&nbsp;the&nbsp;select&nbsp;statement</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>us_wildfires</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>id</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>us_wildfires</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>geom</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span><span>&nbsp;geom,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>us_wildfires</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>stat_cause_descr</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>us_wildfires</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_size</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>us_wildfires</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>fire_name</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>us_wildfires</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>nwcg_reporting_unit_name</span></span><span>,</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>us_wildfires</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>discovery_date</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--constant syntax--other syntax--database-name syntax--sql"><span>public</span></span><span>.</span><span class="syntax--constant syntax--other syntax--table-name syntax--sql"><span>us_wildfires</span></span><span>&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;source&nbsp;table</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>where</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--sql"><span>&gt;</span></span><span>&nbsp;acres&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;acres&nbsp;is&nbsp;variable</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>and</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;stat_cause_descr&nbsp;</span><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>like</span></span><span>&nbsp;cause&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;cause&nbsp;is&nbsp;variable</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>order&nbsp;by</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_size&nbsp;</span><span class="syntax--keyword syntax--other syntax--order syntax--sql"><span>desc</span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--case syntax--sql"><span>END</span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>$$&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;convention&nbsp;that&nbsp;shows&nbsp;function&nbsp;block</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>language&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>plpgsql</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>***&nbsp;Example&nbsp;of&nbsp;use:&nbsp;find&nbsp;all&nbsp;arson&nbsp;at&nbsp;least&nbsp;1,000&nbsp;acres&nbsp;***</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_by_cause(</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>%Arson%</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>1000</span></span><span>);</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--block syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>/*</span></span><span>***&nbsp;Example&nbsp;of&nbsp;use:&nbsp;create&nbsp;point&nbsp;layer&nbsp;***</span><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>*/</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--create syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>create</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>table</span></span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arson_larger_than_1000</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--alias syntax--sql"><span>as</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>select</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--star syntax--sql"><span>*</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--keyword syntax--other syntax--DML syntax--sql"><span>from</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;fire_by_cause(</span><span class="syntax--string syntax--quoted syntax--single syntax--sql"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--sql"><span>'</span></span><span>%Arson%</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--sql"><span>'</span></span></span><span>,&nbsp;</span><span class="syntax--constant syntax--numeric syntax--sql"><span>1000</span></span><span>);</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;table</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;arson_larger_than_1000</span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--meta syntax--add syntax--sql"><span class="syntax--keyword syntax--other syntax--create syntax--sql"><span>add</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--sql"><span>primary&nbsp;key</span></span></span><span>&nbsp;(id),&nbsp;</span><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;define&nbsp;which&nbsp;field&nbsp;is&nbsp;unique&nbsp;id</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span class="syntax--comment syntax--line syntax--double-dash syntax--sql"><span class="syntax--punctuation syntax--definition syntax--comment syntax--sql"><span>--</span></span><span>&nbsp;define&nbsp;geometry&nbsp;type&nbsp;of&nbsp;geom&nbsp;column.&nbsp;Source&nbsp;table&nbsp;gives&nbsp;geometry(Point,4269)</span></span></span></div><div class="line"><span class="syntax--source syntax--sql"><span>alter&nbsp;column&nbsp;geom&nbsp;TYPE&nbsp;geometry(</span><span class="syntax--storage syntax--type syntax--sql"><span>Point</span></span><span>,</span><span class="syntax--constant syntax--numeric syntax--sql"><span>4269</span></span><span>);</span></span></div></pre>
<p>Now you have simple tool to analyze fire by cause and size. Example output from the above query:</p>
<p><img alt="Wildfire caused by arson and are greater than a 1,000 acres" src="graphics/q102_fire_arson.png"><br>Figure 40: Wildfire caused by arson and are greater than a 1,000 acres</p>
<h2 id="resources-and-references">Resources and references</h2>
<ul>
<li><a href="https://www.mapbox.com/blog/binning-alternative-point-maps/">Binning: An Alternative to Point Maps</a> (blog post by Nate Smith)</li>
<li>CartoDB <a href="https://github.com/CartoDB/cartodb-postgresql">PostgreSQL extension</a></li>
</ul></body>
</html>
